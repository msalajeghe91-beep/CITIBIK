name: CI

on:
  push:
  pull_request:

jobs:
  lint-and-smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install ruff

      # IMPORTANT lint: only real code, not notebooks
      - name: Lint (code only)
        run: |
          ruff check src scripts tests

      # optional: formatting check, still only code
      - name: Format check (code only)
        run: |
          ruff format --check src scripts tests

      # important: prove CLIs at least import and parse args
      - name: CLI help smoke
        run: |
          python -m pip freeze | head -n 50
          python src/ingest_tripdata.py --help
          python scripts/summarize_citibike_usage.py --help
          python scripts/build_axa_scorecard.py --help

      # REAL smoke pipeline
      - name: Smoke pipeline (fixture)
        run: |
          make smoke
